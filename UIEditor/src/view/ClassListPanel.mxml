<?xml version="1.0" encoding="utf-8"?>
<s:Panel xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" width="400" height="300"
		 addedToStage="panel1_addedToStageHandler(event)"
		 >
	<fx:Script>
		<![CDATA[
			import data.Config;
			
			import event.UIEvent;
			
			import mx.controls.Alert;
			import mx.events.DragEvent;
			import mx.events.ListEvent;
			
			protected function panel1_addedToStageHandler(event:Event):void
			{
				if(App.rslLoaded)initData();
				else App.addEventListener(UIEvent.RSL_LOAD_COMPLETE,initData);
			}
			
			private function initData(evt:Event=null):void
			{
				init();
				initEvent();
			}
			
			private function init():void
			{
				if(App.xmlLoaded)
				{
					onXmlClassLoadedHandler();
				}
			}
			
			private function initEvent():void
			{
				App.addEventListener(UIEvent.XML_CLASS_LOADED,onXmlClassLoadedHandler);
				App.addEventListener(UIEvent.CLASS_UPDATE,onClassUpdateHandler);
			}
			
			protected function classList_itemDoubleClickHandler(evt:ListEvent):void
			{
				var className:String = evt.itemRenderer.data.value;
				App.dispathEvent(new UIEvent(UIEvent.SELECT_A_CLASS,className));
			}
			
			private function onXmlClassLoadedHandler(evt:UIEvent=null):void
			{
				classList.dataProvider = App.getChildList();
			}
			
			private function onClassUpdateHandler(evt:UIEvent):void
			{
				classList.dataProvider = App.getChildList();
				
				var className:String = String(evt.data);
				App.dispathEvent(new UIEvent(UIEvent.SELECT_A_CLASS,className));
			}
			
			protected function delClassHandler(event:MouseEvent):void
			{
				if(classList.selectedItem)
				{
					var className:String = classList.selectedItem.value;
					App.delClass(className);
					Alert.show("删除成功");
					App.log.echo("删除类：",className);
				}
			}
			
			protected function dragStartHandler(event:DragEvent):void
			{
//				trace(event);				
			}
			
			protected function classDragCompleteHandler(event:DragEvent):void
			{
//				trace(event);
			}
			
			protected function classList_changeHandler(event:ListEvent):void
			{
				var item:Object = classList.selectedItem;
				if(item)System.setClipboard(item.value);				
			}
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
	</fx:Declarations>
	<s:VGroup width="100%" height="100%">
		<mx:Tree id="classList" width="100%" height="100%" contentBackgroundColor="#FFFFFF"
				 doubleClickEnabled="true"
				 change="classList_changeHandler(event)" 
				 itemDoubleClick="classList_itemDoubleClickHandler(event)"
				 allowDragSelection="false"
				 dragEnabled="true"
				 dragComplete="classDragCompleteHandler(event)" 
				 dragStart="dragStartHandler(event)"
				 labelField="label"
				 toolTip="双击切换或者选中一个类来编辑,选中某一个类，会复制该类名到复制框"
				 >
		</mx:Tree>
		<s:Image x="10" y="10" source="assets/systemIcons/gcroot_co.png" buttonMode="true" click="delClassHandler(event)"/>
	</s:VGroup>
</s:Panel>
